<!-- build time:Sun May 31 2020 16:56:36 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-240x240-playpi.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-playpi.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-playpi.png?v=5.1.3"><link rel="mask-icon" href="/images/logo-playpi.svg?v=5.1.3" color="#222"><meta name="keywords" content="Python,Java,Linux,Hadoop,Spark,Yarn,HBase,Elasticsearch,Phoenix,Excel,Shell,Kakfa,Zookeeper"><link rel="alternate" href="/atom.xml" title="虾丸派" type="application/atom+xml"><meta name="description" content="本文记录一些工作当中常用的小工具、小技巧，有时候自己可以查看备忘，同时也给读者参考。当然，内容是在不断补充的，涉及的维度也会扩展。"><meta name="keywords" content="Python,Java,Linux,Hadoop,Spark,Yarn,HBase,Elasticsearch,Phoenix,Excel,Shell,Kakfa,Zookeeper"><meta property="og:type" content="article"><meta property="og:title" content="在技术之路上的一些小技巧"><meta property="og:url" content="https://www.playpi.org/2020021301.html"><meta property="og:site_name" content="虾丸派"><meta property="og:description" content="本文记录一些工作当中常用的小工具、小技巧，有时候自己可以查看备忘，同时也给读者参考。当然，内容是在不断补充的，涉及的维度也会扩展。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2020/20200412175009.jpg"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2020/20200412175024.jpg"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2020/20200412175032.jpg"><meta property="og:updated_time" content="2020-02-12T17:26:47.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="在技术之路上的一些小技巧"><meta name="twitter:description" content="本文记录一些工作当中常用的小工具、小技巧，有时候自己可以查看备忘，同时也给读者参考。当然，内容是在不断补充的，涉及的维度也会扩展。"><meta name="twitter:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2020/20200412175009.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.3",sidebar:{position:"left",display:"hide",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.playpi.org/2020021301.html"><title>在技术之路上的一些小技巧 | 虾丸派</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">虾丸派</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">烂笔头</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-books"><a href="/books/" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i><br>书籍</a></li><li class="menu-item menu-item-guide"><a href="/guide/" rel="section"><i class="menu-item-icon fa fa-fw fa-location-arrow"></i><br>指南</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.playpi.org/2020021301.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="虾丸派"><meta itemprop="description" content="记录知识 | 分享技术"><meta itemprop="image" content="/images/favicon-1536x1536-playpi.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="虾丸派"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">在技术之路上的一些小技巧</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-13T01:26:47+08:00">2020-02-13 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/basic-technical-knowledge/" itemprop="url" rel="index"><span itemprop="name">基础技术知识</span> </a></span></span><span id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-divider">|</span> 阅读次数 <span id="busuanzi_value_page_pv"></span></span><div class="post-wordcount"><span class="post-meta-item-text">字数统计</span> <span title="字数统计">4,942字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">20分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p>本文记录一些工作当中常用的小工具、小技巧，有时候自己可以查看备忘，同时也给读者参考。当然，内容是在不断补充的，涉及的维度也会扩展。</p><a id="more"></a><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p><code>Python</code> 是一种脚本语言，想要运行 <code>Python</code> 脚本就需要先安装 <code>Python</code> 环境【就像运行 <code>Java</code> 程序需要 <code>JRE</code> 一样】，安装后别忘记配置环境变量。</p><p>官方网站：<a href="https://www.python.org/downloads" target="_blank" rel="noopener">python</a> 。</p><p>唯一需要注意的是安装时先核对脚本的语法，是安装 <code>v2.7.X</code> 版本还是 <code>v3.X</code> 版本，它们的语法有时候不兼容，导致脚本无法跑通。</p><h2 id="虚拟环境"><a href="# 虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><p>在某个项目中，使用 <code>Python</code> 构造 <code>Elasticsearch</code> 请求获取结果数据，但是脚本的内容是针对 <code>Python v3.X</code> 环境的，而服务器上是 <code>Python v2.7</code> 版本的环境，而且个人没有权限更改【如果自己通过编译安装指定的版本，后续使用时如果缺失第三方模块还是需要手动安装，如果又引发模块之间的依赖，手动安装过程会崩溃的】，所以可以在服务器上面虚拟一个指定版本的 <code>Python</code> 环境出来。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 在任意目录，虚拟出 Python 2.7 环境 </span><br><span class="line">virtualenv py2.7</span><br><span class="line">-- 进入环境 </span><br><span class="line">cd py2.7/</span><br><span class="line">-- 激活环境 </span><br><span class="line">source bin/activate</span><br><span class="line">-- 如果缺失第三方模块，直接安装即可 </span><br><span class="line">pip install requests</span><br><span class="line">-- 取消环境 </span><br><span class="line">source bin/deactive</span><br></pre></td></tr></table></figure><h2 id="缓存问题"><a href="# 缓存问题" class="headerlink" title="缓存问题"></a>缓存问题</h2><p>假如跑一个脚本，把输出重定向到一个文件中：<code>nohup python test.py &gt; nohup.out 2&gt;&amp;1 &amp;</code>，结果发现 <code>nohup.out</code> 中显示不出来 <code>python</code> 程序中 <code>print</code> 的内容【或者是不及时显示，隔一段时间才会有一点内容】。</p><p>这是因为 <code>python</code> 的输出有缓冲机制，导致我们从 <code>nohup.out</code> 中并不能够马上看到输出。其实运行 <code>python</code> 脚本的时候有个 <code>-u</code> 参数，使得 <code>python</code> 不启用缓冲，把程序中的输出内容实时输出到文件：<code>nohup python -u test.py &gt; nohup.out 2&gt;&amp;1 &amp;</code> 。</p><h2 id="编码问题"><a href="# 编码问题" class="headerlink" title="编码问题"></a>编码问题</h2><p><code>python</code> 的 <code>chardet</code> 模块，可以查看字符串的编码：<code>chardet.detect (data)</code> 。</p><h2 id="处理文本文件"><a href="# 处理文本文件" class="headerlink" title="处理文本文件"></a> 处理文本文件</h2><p>在处理 <code>csv</code> 文件时，遇到异常：<code>Error: field larger than field limit &lt;131072&gt;</code>，这其实是因为 <code>Python</code> 读取 <code>csv</code> 文件时有一个默认设置，某列的内容最大长度为 131072【基于 <code>Python v2.5</code>】。</p><p>重点在于 <code>Error: field larger than field limit &lt;131072&gt;</code>，是因为 <code>csv</code> 文件中的某个字段的长度大于 <code>csv</code> 框架能处理的最大长度，需要在文件头加上参数配置代码：<code>csv.field_size_limit (sys.maxint)</code> ，这样就可以支持 <code>int</code> 的最大值所对应的长度了。</p><p>此外，由于 <code>csv</code> 文件的特殊性，<code>csv</code> 是特定分隔符分隔的文本文件，可能会导致内容混乱的状况，比如某一列包含了大量的换行符【又没有使用双引号封装起来】，会导致 <code>csv</code> 文件认为就是多行数据，这样这些行都是错误的数据【因为列数不够】，如果有连续的换行符，会导致空白行出现，<code>Python</code> 也会报错：<code>line contains NULL byte</code> 。</p><h1 id="Excel- 的知识"><a href="#Excel- 的知识" class="headerlink" title="Excel 的知识"></a>Excel 的知识</h1><p>对于分析人员，经常会用到 <code>Excel</code> 工具，用来看数据，或者操作数据。</p><p>但是，有时候文本内容过多，不再适合使用 <code>Excel</code> 操作了，不仅很卡，而且有崩溃的风险。</p><p>根据我的经验，以最多 5 万行内容，最大 <code>20MB</code> 为好，如果是 <code>Mac OS</code> 系统，需要更少。</p><p>下面列举一下 <code>Excel</code> 支持的内容上限：</p><p><code>Excel</code> 2003 支持的最大行数是 65536，<code>Excel</code> 2007 支持的最大行数是 1048576 。</p><p><code>Excel</code> 2003 支持的最大列数是 256，<code>Excel</code> 2007 以及以上支持的最大列数是 16384 。</p><p>更多其它规范参考官方介绍：<a href="https://support.office.com/zh-cn/article/Excel-% E8% A7%84% E8%8C%83% E4% B8%8E% E9%99%90% E5%88% B6-1672b34d-7043-467e-8e27-269d656771c3#ID0EBABAAA=Office_2010" target="_blank" rel="noopener">Excel 规范与限制 </a>。</p><h1 id="文件编码转换工具"><a href="# 文件编码转换工具" class="headerlink" title="文件编码转换工具"></a> 文件编码转换工具</h1><p><code>iconv</code> 需要单独安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 转换文件内容编码，从 gb18030 转到 utf-8</span><br><span class="line">iconv --list 查看支持的编码 </span><br><span class="line">iconv -f gb18030 -t utf-8 oldfile -o newfile</span><br><span class="line"></span><br><span class="line">-- 查看文件编码内容简要信息 </span><br><span class="line">file filename</span><br></pre></td></tr></table></figure><h1 id="文件名编码转换工具"><a href="# 文件名编码转换工具" class="headerlink" title="文件名编码转换工具"></a> 文件名编码转换工具</h1><p>在 <code>Linux</code> 系统中，如果把一个以中文命名的文件上传上去【特别是从 <code>Windows</code> 系统上传上去】，文件名可能会乱码，导致无法使用 <code>Shell</code> 操作文件，此时可以使用 <code>xx</code> 工具转换文件名的编码。</p><p><code>convmv</code> 需要单独安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- 转换文件名编码，从 utf-8 转到 gbk</span><br><span class="line">convmv --list 查看支持的编码 </span><br><span class="line">convmv -f utf-8 -t gbk filename 显示效果 </span><br><span class="line">convmv -f utf-8 -t gbk --notest filename 真的转换 </span><br><span class="line"></span><br><span class="line">-- 查看文件编码内容简要信息 </span><br><span class="line">file filename</span><br></pre></td></tr></table></figure><h1 id="常用命令"><a href="# 常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><h2 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h2><h3 id="进程目录"><a href="# 进程目录" class="headerlink" title="进程目录"></a> 进程目录</h3><p>根据进程编号找到启动进程的目录，从而判断进程的启动路径。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwdx pid</span><br></pre></td></tr></table></figure><h3 id="负载查看"><a href="# 负载查看" class="headerlink" title="负载查看"></a>负载查看</h3><p>对于操作系统上面的进程导致的机器负载升高，可以查看到底是哪个进程或者线程导致的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxx</span><br><span class="line">yyy</span><br></pre></td></tr></table></figure><h3 id="进程查看"><a href="# 进程查看" class="headerlink" title="进程查看"></a>进程查看</h3><p>查看某个进程的启动目录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 筛选进程名称，获取 pid</span><br><span class="line">jps | grep &apos;process name&apos;</span><br><span class="line">-- 根据 pid 查看目录 </span><br><span class="line">pwdx &apos;pid&apos;</span><br><span class="line">-- 进入目录 </span><br><span class="line">cd &apos;dir&apos;</span><br></pre></td></tr></table></figure><h3 id="使用 -sed- 操作文本文件"><a href="# 使用 -sed- 操作文本文件" class="headerlink" title="使用 sed 操作文本文件"></a>使用 sed 操作文本文件</h3><p>搜索替换之类的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> 把文件中的 xxx 全部替换为 yyy，不带 -i 参数直接输出内容，不会更改文件 </span><br><span class="line">sed -i &quot;s/xxx/yyy/g&quot; your_file</span><br><span class="line"></span><br><span class="line"> 在文件第 n 行前插入内容 xxx，不带 -i 参数直接输出内容，不会更改文件 </span><br><span class="line"> 注意 Linux 中以换行符 LF 作为一行的判断条件，所以指定不存在的行号时无法插入数据 </span><br><span class="line">sed -i &quot;ni\xxx&quot; your_file</span><br><span class="line"></span><br><span class="line"> 输出文件的第 n 到 m 行内容 </span><br><span class="line">sed -n &quot;n,mp&quot; your_file</span><br></pre></td></tr></table></figure><h3 id="查看 -Linux- 系统的发行版本"><a href="# 查看 -Linux- 系统的发行版本" class="headerlink" title="查看 Linux 系统的发行版本"></a>查看 Linux 系统的发行版本</h3><p><code>lsb_release -a</code>，该命令适用于所有 <code>Linux</code> 系统，会显示出完整的版本信息，包括 <code>Linux</code> 系统的名称，如：<code>Debian</code>、<code>Ubuntu</code>、<code>CentOS</code> 等，和对应的版本号，以及该版本的代号，例如在 <code>Debian 8</code> 中将会显示代号 <code>jessie</code>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> 输出示例：</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:	Ubuntu</span><br><span class="line">Description:	Ubuntu 14.04.6 LTS</span><br><span class="line">Release:	14.04</span><br><span class="line">Codename:	trusty</span><br></pre></td></tr></table></figure><p><code>cat /etc/issue</code>，该命令适用于所有的 <code>Linux</code> 系统，显示的版本信息较为简略，只有系统名称和对应的版本号。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> 输出示例：</span><br><span class="line">Ubuntu 14.04.6 LTS \n \l</span><br></pre></td></tr></table></figure><p><code>cat /etc/redhat-release</code>，该命令仅适用于 <code>Redhat</code> 系列的 <code>Linux</code> 系统，显示的版本信息也较为简略。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> 输出示例：</span><br><span class="line">CentOS release 6.10 (Final)</span><br></pre></td></tr></table></figure><p><code>uname -a</code>、<code>cat /proc/version</code>，可以查看 <code>Linux</code> 的内核版本：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 输出示例 1：</span><br><span class="line">Linux wufazhuce 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br><span class="line"> 输出示例 2：</span><br><span class="line">Linux version 3.13.0-32-generic (buildd@kissel) (gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) ) #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014</span><br></pre></td></tr></table></figure><h3 id="查看 -Linux- 系统的核数"><a href="# 查看 -Linux- 系统的核数" class="headerlink" title="查看 Linux 系统的核数"></a> 查看 Linux 系统的核数</h3><p>继续阅读之前先搞清楚几个概念：物理 <code>CPU</code> 个数、单颗 <code>CPU</code> 核数、单核 <code>CPU</code> 线程数。</p><ul><li>一台物理机的 <code>CPU</code> 个数</li><li>一个 <code>CPU</code> 的核数</li><li>一个 <code>CPU</code> 核上面支持的线程数</li></ul><p>当一台机器有多个物理 <code>CPU</code>，那么各个 <code>CPU</code> 之间就要通过总线进行通信，效率比较低。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2020/20200412175009.jpg" alt="多个 CPU 通过总线通信" title="多个 CPU 通过总线通信"></p><p>此时可以利用多核的特性，在多核 <code>CPU</code> 上，不同的核之间通过 <code>L2 cache</code> 进行通信，存储和外设通过总线与 <code>CPU</code> 通信，效率提高。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2020/20200412175024.jpg" alt="多核之间通信" title="多核之间通信"></p><p>当然，如果利用多核超线程，即每个 <code>CPU</code> 核有两个逻辑的处理单元，两个线程共同分享一个 <code>CPU</code> 核的资源，计算起来更快。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2020/20200412175032.jpg" alt="多核超线程" title="多核超线程"></p><p>因此，一台机器的总核数为：物理机的 <code>CPU</code> 个数 X 一个 <code>CPU</code> 的核数，总逻辑 <code>CPU</code> 个数为：物理机的 <code>CPU</code> 个数 X 一个 <code>CPU</code> 的核数 X 一个 <code>CPU</code> 核上面支持的线程数。</p><p>查看一台机器的 <code>CPU</code> 信息，主要就是 <code>/proc/cpuinfo</code> 文件，里面包含了关于 <code>CPU</code> 的信息，以 <code>CentOS</code> 系统为例，输出内容如下【只是截取了一小部分】：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">processor	: 23</span><br><span class="line">vendor_id	: GenuineIntel</span><br><span class="line">cpu family	: 6</span><br><span class="line">model		: 62</span><br><span class="line">model name	: Intel (R) Xeon (R) CPU E5-2620 v2 @ 2.10GHz</span><br><span class="line">stepping	: 4</span><br><span class="line">microcode	: 1060</span><br><span class="line">cpu MHz		: 1200.000</span><br><span class="line">cache size	: 15360 KB</span><br><span class="line">physical id	: 1</span><br><span class="line">siblings	: 12</span><br><span class="line">core id		: 5</span><br><span class="line">cpu cores	: 6</span><br><span class="line">apicid		: 43</span><br><span class="line">initial apicid	: 43</span><br><span class="line">fpu		: yes</span><br><span class="line">fpu_exception	: yes</span><br><span class="line">cpuid level	: 13</span><br><span class="line">wp		: yes</span><br><span class="line">flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm ida arat epb xsaveopt pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase smep erms</span><br><span class="line">bogomips	: 4189.67</span><br><span class="line">clflush size	: 64</span><br><span class="line">cache_alignment	: 64</span><br><span class="line">address sizes	: 46 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>其中，<code>model name</code> 表示 <code>CPU</code> 的型号；<code>physical id</code> 表示物理 <code>CPU</code> 个数，编号从 0 开始；<code>cpu cores</code> 表示单颗 <code>CPU</code> 核数；<code>processor</code> 表示所有 <code>CPU</code> 线程数，编号从 0 开始。</p><p>因此，查看 <code>CPU</code> 信息时可以使用管道、过滤、查找来输出需要的内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 查看 CPU 型号信息 </span><br><span class="line">cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c</span><br><span class="line"></span><br><span class="line"> 查看物理 CPU 个数 </span><br><span class="line">cat /proc/cpuinfo | grep &quot;physical id&quot; | sort | uniq | wc -l</span><br><span class="line"></span><br><span class="line"> 查看单颗 CPU 核数 </span><br><span class="line">cat /proc/cpuinfo | grep &quot;cpu cores&quot; | uniq</span><br><span class="line"></span><br><span class="line"> 查看所有 CPU 线程数 </span><br><span class="line">cat /proc/cpuinfo | grep &quot;processor&quot; | wc -l</span><br></pre></td></tr></table></figure><p>顺带提一下查看内存的信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/meminfo</span><br></pre></td></tr></table></figure><h3 id="split- 拆分文件"><a href="#split- 拆分文件" class="headerlink" title="split 拆分文件"></a>split 拆分文件</h3><p>把文件按照 60 行一个文件进行拆分，拆分后的文件以 <code>data_</code> 作为前缀，以 2 位数字作为后缀：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">split -l 60 your_file -d -a 2 data_</span><br><span class="line"></span><br><span class="line"> 拆分后的文件为 data_00、data_01、data_02 等等 </span><br></pre></td></tr></table></figure><h3 id="curl- 请求网络"><a href="#curl- 请求网络" class="headerlink" title="curl 请求网络"></a>curl 请求网络</h3><p>可以模拟请求，传输参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST 请求，参数放在 seeds 中 </span><br><span class="line">curl --location --request POST &apos;url&apos; \</span><br><span class="line">--header &apos;content-type: application/x-www-form-urlencoded; charset=UTF-8&apos; \</span><br><span class="line">--header &apos;Content-Type: application/x-www-form-urlencoded&apos; \</span><br><span class="line">--data-urlencode &apos;seeds=[&#123;&quot;keyword&quot;:&quot; 王者荣耀 & quot;, &quot;TOP_PAGE&quot;: &quot;100&quot;&#125;,&#123;&quot;keyword&quot;:&quot;LOL&quot;, &quot;TOP_N&quot;: &quot;100&quot;&#125;]&apos;</span><br><span class="line"></span><br><span class="line">GET 请求，获取信息 </span><br><span class="line">curl --location --request GET url&apos;</span><br><span class="line"></span><br><span class="line">POST 请求，参数放在文件中 </span><br><span class="line">curl -X POST --data-binary @your_file url</span><br></pre></td></tr></table></figure><p>查询 <code>Elasticsearch</code> 的数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 查询指定索引、指定类型的数据，返回 1 条数据，格式化结果 </span><br><span class="line">curl -X POST &apos;dev:9202/your_index/your_type/_search?pretty&apos; -d &apos;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,&quot;size&quot;:1</span><br><span class="line">&#125;&apos;</span><br></pre></td></tr></table></figure><h3 id="文本文件行数"><a href="# 文本文件行数" class="headerlink" title="文本文件行数"></a>文本文件行数</h3><p>获取文本文件的内容行数，返回数值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc -l 输入文件名称 </span><br></pre></td></tr></table></figure><h3 id="文件去重"><a href="# 文件去重" class="headerlink" title="文件去重"></a>文件去重</h3><p>对单个文本文件的内容进行去重，返回去重后的文本：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort 输入文件 | uniq &gt; 输出文件 </span><br></pre></td></tr></table></figure><p>说明：<code>|</code> 竖线表示管道，把前一个命令的输出作为后一个命令的输入，<code>&gt;</code> 右尖括号表示重定向，把前一个命令的输出内容导出到文件中，<code>sort</code> 表示排序，但是并不会去除重复内容，所以会有重复的行，<code>uniq</code> 表示去除重复的内容，则输出结果就是去重后的内容。</p><h3 id="随机获取文本内容"><a href="# 随机获取文本内容" class="headerlink" title="随机获取文本内容"></a>随机获取文本内容</h3><p>随机抽取单个文件中的内容行数，例如随机输出 100 行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shuf -n 行数 输入文件 &gt; 输出文件 </span><br></pre></td></tr></table></figure><p>说明：<code>-n</code> 后面紧跟着数字，表示行数，不需要空格。</p><h3 id="计算交集差集并集"><a href="# 计算交集差集并集" class="headerlink" title="计算交集差集并集"></a>计算交集差集并集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat 输入文件 1 输入文件 2 | sort | uniq -d &gt; 输出文件 </span><br></pre></td></tr></table></figure><p>说明：<code>cat</code> 表示查看文件内容，<code>uniq</code> 的 <code>-d</code> 参数表示抽取重复的内容，即出现 2 次及以上的内容，在这里得到的结果也就是交集了。</p><p>此外，还有 <code>-u</code> 参数表示抽取唯一的内容，则可以计算差集。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat 输入文件 1 输入文件 2 输入文件 2 | sort | uniq -u &gt; 输出文件（注意输入文件 2 故意重复 2 次）</span><br></pre></td></tr></table></figure><p>说明：<code>uniq</code> 的 <code>-u</code> 参数表示抽取唯一的内容，即只出现一次的内容，这样得到的输出结果必然是只在输入文件 1 中，而不在输入文件 2 中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat 输入文件 1 输入文件 2 | sort | uniq &gt; 输出文件 </span><br></pre></td></tr></table></figure><p>说明：这个很容易理解了，合并文件后简单去重，也就是并集了。</p><h2 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h2><p>查看 <code>topic</code> 信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --list --zookeeper dev:2181</span><br></pre></td></tr></table></figure><p>生产数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-producer.sh --topic your_topic --broker-list dev:9092</span><br></pre></td></tr></table></figure><p>消费数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer.sh --zookeeper dev:2181 --topic your_topic</span><br></pre></td></tr></table></figure><p>查看 <code>topic</code> 状态：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --zookeeper dev:2181 --describe --topic your_topic</span><br></pre></td></tr></table></figure><p>查看消费情况【消费组消费量、积压量、生产量】：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kafka-consumer-offset-checker.sh --zookeeper dev:2181 --group your_group --topic your_topic</span><br><span class="line"></span><br><span class="line"> 如果上述脚本不可用，可以直接引用类 </span><br><span class="line">kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --group your_group --topic your_topic --zkconnect dev:2181</span><br></pre></td></tr></table></figure><h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><p>操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 登录 </span><br><span class="line">zkCli.sh -server ip:port</span><br><span class="line"></span><br><span class="line"> 退出 </span><br><span class="line">quit</span><br></pre></td></tr></table></figure><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 登录，n 表示桶，默认 0</span><br><span class="line">redis-cli -h host -p port -n 0 --raw</span><br><span class="line"></span><br><span class="line"> 查看配置信息，例如数据量、占用内存 </span><br><span class="line">info</span><br><span class="line"></span><br><span class="line"> 查看单个配置项，例如最大内存 </span><br><span class="line">config get maxmemory</span><br><span class="line"></span><br><span class="line"> 退出 </span><br><span class="line">quit</span><br></pre></td></tr></table></figure><h2 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h2><p><code>HBase</code> 操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> 登录 </span><br><span class="line">hbase shell</span><br><span class="line"></span><br><span class="line"> 帮助文档 </span><br><span class="line">!help</span><br><span class="line"></span><br><span class="line"> 退格 </span><br><span class="line">ctrl + Backspace</span><br><span class="line"></span><br><span class="line"> 退出 </span><br><span class="line">!quit</span><br><span class="line"></span><br><span class="line"> 查看表信息 </span><br><span class="line">!list</span><br><span class="line"></span><br><span class="line"> 获取数据 </span><br><span class="line">get &apos; 表名称 & apos;,&apos;pk 值 & apos;</span><br><span class="line"></span><br><span class="line"> 扫描数据 </span><br><span class="line">scan &apos; 表名称 & apos;,&#123;LIMIT =&gt; 5&#125;</span><br><span class="line"></span><br><span class="line"> 检查 Region 状态 </span><br><span class="line">hbase hbck</span><br><span class="line"></span><br><span class="line"> 此命令用于修复未分配，错误分配或者多次分配 Region 的问题，注意用户权限问题 </span><br><span class="line">hbase hbck -fixAssignments</span><br><span class="line">sudo -u hbase hbase hbck -fixAssignments</span><br><span class="line"></span><br><span class="line"> 检查 Region 的元数据 </span><br><span class="line">get &apos;hbase:meta&apos;,&apos;your_region_name&apos;</span><br><span class="line"></span><br><span class="line"> 检测数据表的状态 </span><br><span class="line">hbase hbck&quot;YOUR_TABLE&quot;</span><br><span class="line"></span><br><span class="line"> 修复 Region 空洞问题【Region hole】，注意用户权限问题 </span><br><span class="line">sudo -u hbase hbase hbck -fix&quot;YOUR_TABLE&quot;</span><br><span class="line"></span><br><span class="line"> 手动做 major_compact</span><br><span class="line">major_compact &quot;your_table_name&quot;</span><br></pre></td></tr></table></figure><p><code>phoenix</code> 操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> 登录 </span><br><span class="line">phoenix-client/bin/sqlline.py dev:2181:/hbase-unsecure</span><br><span class="line"></span><br><span class="line"> 帮助文档 </span><br><span class="line">!help</span><br><span class="line"></span><br><span class="line"> 退出 </span><br><span class="line">!quit</span><br><span class="line"></span><br><span class="line"> 查看表信息 </span><br><span class="line">!tables</span><br><span class="line"></span><br><span class="line"> 查询数据 </span><br><span class="line">select * from &quot; 表名称 & quot; where &quot;pk&quot;=&apos;pk 值 & apos;;</span><br><span class="line">select * from &quot; 表名称 & quot; limit 5;</span><br><span class="line"></span><br><span class="line"> 导出数据 </span><br><span class="line">-- 格式化输出 </span><br><span class="line">!outputformat csv</span><br><span class="line">-- 设置导出文件到 data.csv</span><br><span class="line">!record data.csv</span><br><span class="line">-- 查询需要导出的数据 </span><br><span class="line">select * from &quot; 表名称 & quot; limit 1000;</span><br><span class="line">-- 完成导数操作 </span><br><span class="line">!record</span><br><span class="line"></span><br><span class="line"> 格式化显示 </span><br><span class="line">!outputformat vertical</span><br><span class="line">!outputformat csv</span><br><span class="line">!outputformat table</span><br></pre></td></tr></table></figure><h2 id="Spark"><a href="#Spark" class="headerlink" title="Spark"></a>Spark</h2><p>启动 <code>Spark</code> 命令行，使用 <code>spark-shell --master yarn-client</code>，然后就可以在交互式命令行中写 <code>scala</code>、<code>python</code> 代码了。</p><p>举例：读取 2 个文件，做并集：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var list1=sc.textFile (&quot;/tmp/pengfei/file1.txt&quot;).flatMap (x =&gt; x.split (&quot;\\t&quot;))</span><br><span class="line"> 文件在 HDFS 中，一行数据有被 Tab 分隔的多条内容 </span><br><span class="line"></span><br><span class="line">var list2=sc.textFile (&quot;/tmp/pengfei/file2.txt&quot;).flatMap (x =&gt; x.split (&quot;\\t&quot;))</span><br><span class="line"></span><br><span class="line">list1.union (list2).saveAsTextFile (&quot;/tmp/pengfei/union.txt&quot;)</span><br></pre></td></tr></table></figure><p>触发任务后在 <code>yarn</code> 中就可以看到任务的运行情况，注意，启动 <code>Spark-shell</code> 的时候也可以直接在本地运行，但是处理数据量大的时候内存会不够用，不建议。启动 <code>Spark-Shell</code> 的时候，可以指定使用 <code>yarn</code> 模式：<code>spark-shell --master yarn-client</code>，如果不指定，默认在本地启动，内存与处理速度会慢。</p><p><code>spark-shell --help</code>，查看启动参数详情，例如以下参数，<code>--executor-memory 4G</code>、<code>--total-executor-cores 4</code>、<code>--executor-cores 2</code> 可以加大内存，增加 <code>core</code> 数。</p><p>常用方法举例：<code>dinstinct</code>【去重】、<code>intersection</code>【交集】、<code>subtract</code>【差集】、<code>union</code>【并集】、<code>saveAsTextFile</code>【导出】、<code>textFile</code>【读取】。</p><p>分割去重过滤：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.flatMap (x=&gt;x.split (&quot;\\t&quot;)).distinct ().filter (x=&gt;11&gt;x.length ())</span><br></pre></td></tr></table></figure><p>单词计数写回文件，按照 <code>value</code> 降序排列：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">val wordcount = sc.textFile (&quot;&quot;).flatMap (line =&gt; line.split (&quot;\\t&quot;)).map (word =&gt; (word, 1)).reduceByKey ((a, b) =&gt; a + b)</span><br><span class="line"></span><br><span class="line">val finalresult=wordcount.filter (count =&gt; count._2 &gt; 100)</span><br><span class="line"></span><br><span class="line">finalresult.persist ()</span><br><span class="line"></span><br><span class="line">finalresult.foreach (println)</span><br><span class="line"></span><br><span class="line">finalresult.count ()</span><br><span class="line"></span><br><span class="line">finalresult=finalresult.sortBy (_._2,false)</span><br><span class="line"></span><br><span class="line">val textresult=finalresult.map (count =&gt; count._1 + &quot;,&quot; + count._2)</span><br><span class="line"></span><br><span class="line">textresult.foreach (println)</span><br><span class="line"></span><br><span class="line">textresult.saveAsTextFile (&quot;&quot;)</span><br></pre></td></tr></table></figure><h1 id="大数据任务调度系统"><a href="# 大数据任务调度系统" class="headerlink" title="大数据任务调度系统"></a>大数据任务调度系统</h1><h2 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h2><h3 id="移动队列"><a href="# 移动队列" class="headerlink" title="移动队列"></a> 移动队列</h3><p>在资源紧张的情况下，可以手动移动 <code>Spark</code> 任务的队列，合理利用空闲的资源。</p><p>如果 <code>yarn</code> 队列没有资源了，而自己又有 <code>Spark</code> 任务需要跑，在提交 <code>Spark</code> 任务后，可以看到任务在等待分配资源，此时可以把 <code>Spark</code> 任务移动到别的空闲队列去【也可以在提交 <code>Spark</code> 任务的时候指定队列】。</p><p>或者某些运行耗时比较长的任务，也可以先移动到别的空闲队列跑，释放自己业务的队列资源给其它任务使用。前提是确保不影响别的队列的正常使用，不能长久占用别人的队列。</p><p>使用 <code>yarn</code> 自带的命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 指定 Spark 任务的 applicationId，以及目标队列名称 </span><br><span class="line">-- 注意用户权限 </span><br><span class="line">yarn application -movetoqueue applicationId -queue queueName</span><br></pre></td></tr></table></figure><p>如果不熟悉这些命令，可以使用 <code>yarn -help</code>、<code>yarn application -help</code> 等命令查看帮助说明文档。</p><h3 id="取消任务"><a href="# 取消任务" class="headerlink" title="取消任务"></a>取消任务</h3><p>如果想 <code>kill</code> 掉一个正在 <code>yarn</code> 环境上运行的 <code>Spark</code> 任务，可以直接使用 <code>kill</code> 命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 指定 Spark 任务的 applicationId</span><br><span class="line">yarn application -kill applicationId</span><br></pre></td></tr></table></figure><p>当然，如果使用的 <code>yarn-client</code> 模式提交任务，并且有权限看到 <code>Driver</code> 端的进程，也可以直接使用 <code>Linux</code> 的命令 <code>kill</code> 掉进程【不够优雅】。</p><h3 id="下载日志"><a href="# 下载日志" class="headerlink" title="下载日志"></a>下载日志</h3><p>下载已经完成的 <code>Spark</code> 任务的文本日志，在 <code>Saprk</code> 任务的 <code>UI</code> 界面，可以看到 <code>Excutor</code> 的日志，但是当日志多的时候，看起来不方便，搜索就更不用说了。</p><p>当任务完成之后，可以使用 <code>yarn</code> 命令下载文本日志进行查看、分析：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 指定 Spark 任务的 applicationId，所属用户 </span><br><span class="line">yarn logs -applicationId applicationId -appOwner userName</span><br></pre></td></tr></table></figure><p>注意，由于用户权限的问题，在下载日志之前需要切换用户，否则获取不到日志或者抛出权限相关错误：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 切换用户，根据实际情况而定 </span><br><span class="line">-- 决定着去哪个目录获取日志文件 </span><br><span class="line">export HADOOP_USER_NAME=xxx</span><br></pre></td></tr></table></figure><h1 id="操作系统"><a href="# 操作系统" class="headerlink" title="操作系统"></a>操作系统</h1><h2 id="回车换行"><a href="# 回车换行" class="headerlink" title="回车换行"></a> 回车换行</h2><p>在文本数据处理中，<code>CR</code>、<code>LF</code>、<code>CR/LF</code> 是不同操作系统上使用的换行符，表现为文本另起一行输出。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CR：Carriage Return</span><br><span class="line">LF：Line Feed</span><br></pre></td></tr></table></figure><p>下面列出常见的操作系统标准：</p><ul><li><code>Dos</code> 和 <code>Windows</code> 采用回车符 + 换行符，<code>CR/LF</code> 表示下一行</li><li><code>UNIX/Linux</code> 采用换行符，<code>LF</code> 表示下一行</li><li>苹果 <code>MAC OS</code> 系统则采用回车符，<code>CR</code> 表示下一行</li></ul><p>还需要注意，<code>CR</code> 用符号 <code>\\r</code> 表示，十进制 <code>ASCII</code> 编码是 13，十六进制编码为 <code>0x0d</code>，<code>LF</code> 使用 <code>\\n</code> 符号表示，十进制 <code>ASCII</code> 编码是 10，十六制编码为 <code>0x0a</code> 。</p><p>所以在 <code>Windows</code> 平台上的换行效果，在文本文件中是使用 <code>0d</code>、<code>0a</code> 这两个字节来实现的，而 <code>UNIX</code> 和苹果平台上的换行效果则是使用 <code>0a</code> 或 <code>0d</code> 一个字符来实现的，节约了存储空间。</p><p>在一个操作系统平台上使用另一种换行标准的文本文件，可能会带来意想不到的问题，特别是在程序代码中，有时候代码在编辑器中显示正常，但是在编译打包时却会因为换行符问题而出错【备注：使用 <code>Git</code> 版本控制系统时，<code>Git</code> 客户端已经根据当前的操作系统环境，自动帮助我们实时替换了换行符号】。</p><p>例如常见的一个现象，<code>Unix/Mac</code> 系统下的文件在 <code>Windows</code> 里打开的时候，会发现所有的文字变成了一行，而同理，<code>Windows</code> 里的文件在 <code>Unix/Mac</code> 下打开的话，在每行的结尾可能会多出一个 <code>^M</code> 符号。</p></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"><img id="wechat_subscriber_qcode" src="/images/wechat-qr-personal.jpg" alt="虾丸派 wechat" style="width:200px;max-width:100%"><div>扫一扫添加博主，进技术交流群，共同学习进步</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>永不止步</div><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechat-pay-playpi.png" alt="虾丸派 微信支付"><p>微信支付</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> 虾丸派</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://www.playpi.org/2020021301.html" title="在技术之路上的一些小技巧">https://www.playpi.org/2020021301.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Elasticsearch/" rel="tag"><i class="fa fa-tag"></i> Elasticsearch</a> <a href="/tags/Hadoop/" rel="tag"><i class="fa fa-tag"></i> Hadoop</a> <a href="/tags/Spark/" rel="tag"><i class="fa fa-tag"></i> Spark</a> <a href="/tags/Yarn/" rel="tag"><i class="fa fa-tag"></i> Yarn</a> <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a> <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a> <a href="/tags/HBase/" rel="tag"><i class="fa fa-tag"></i> HBase</a> <a href="/tags/Shell/" rel="tag"><i class="fa fa-tag"></i> Shell</a> <a href="/tags/Phoenix/" rel="tag"><i class="fa fa-tag"></i> Phoenix</a> <a href="/tags/Zookeeper/" rel="tag"><i class="fa fa-tag"></i> Zookeeper</a> <a href="/tags/Excel/" rel="tag"><i class="fa fa-tag"></i> Excel</a> <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a> <a href="/tags/Kakfa/" rel="tag"><i class="fa fa-tag"></i> Kakfa</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2020012201.html" rel="next" title="Spark 警告：Not enough space to cache rdd in memory"><i class="fa fa-chevron-left"></i> Spark 警告：Not enough space to cache rdd in memory</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2020030201.html" rel="prev" title="在 Elasticsearch 中指定查询返回的字段">在 Elasticsearch 中指定查询返回的字段 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="vcomments"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/favicon-1536x1536-playpi.png" alt="虾丸派"><p class="site-author-name" itemprop="name">虾丸派</p><p class="site-description motion-element" itemprop="description">记录知识 | 分享技术</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">294</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/iplaypi" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://weibo.com/u/3086148515" target="_blank" title="微博"><i class="fa fa-fw fa-weibo"></i>微博</a> </span><span class="links-of-author-item"><a href="mailto:playpi@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank" rel="external nofollow"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://github.com/iplaypi" title="GitHub" target="_blank" rel="external nofollow">GitHub</a></li><li class="links-of-blogroll-item"><a href="https://weibo.com/u/3086148515" title="Weibo" target="_blank" rel="external nofollow">Weibo</a></li><li class="links-of-blogroll-item"><a href="https://www.playpi.org" title="虾丸派" target="_blank" rel="external nofollow">虾丸派</a></li><li class="links-of-blogroll-item"><a href="https://www.playpi.org" title="playpi" target="_blank" rel="external nofollow">playpi</a></li><li class="links-of-blogroll-item"><a href="https://www.liaoxuefeng.com" title="廖雪峰" target="_blank" rel="external nofollow">廖雪峰</a></li><li class="links-of-blogroll-item"><a href="http://www.ruanyifeng.com" title="阮一峰" target="_blank" rel="external nofollow">阮一峰</a></li><li class="links-of-blogroll-item"><a href="https://travis-ci.org/iplaypi/iplaypi.github.io" title="travis-ci" target="_blank" rel="external nofollow">travis-ci</a></li><li class="links-of-blogroll-item"><a href="https://www.vultr.com/?ref=7861302-4F" title="Vultr" target="_blank" rel="external nofollow">Vultr</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Python"><span class="nav-number">1.</span> <span class="nav-text">Python</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#虚拟环境"><span class="nav-number">1.1.</span> <span class="nav-text">虚拟环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存问题"><span class="nav-number">1.2.</span> <span class="nav-text">缓存问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编码问题"><span class="nav-number">1.3.</span> <span class="nav-text">编码问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理文本文件"><span class="nav-number">1.4.</span> <span class="nav-text">处理文本文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Excel- 的知识"><span class="nav-number">2.</span> <span class="nav-text">Excel 的知识</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文件编码转换工具"><span class="nav-number">3.</span> <span class="nav-text">文件编码转换工具</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文件名编码转换工具"><span class="nav-number">4.</span> <span class="nav-text">文件名编码转换工具</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常用命令"><span class="nav-number">5.</span> <span class="nav-text">常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Shell"><span class="nav-number">5.1.</span> <span class="nav-text">Shell</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#进程目录"><span class="nav-number">5.1.1.</span> <span class="nav-text">进程目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#负载查看"><span class="nav-number">5.1.2.</span> <span class="nav-text">负载查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程查看"><span class="nav-number">5.1.3.</span> <span class="nav-text">进程查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用 -sed- 操作文本文件"><span class="nav-number">5.1.4.</span> <span class="nav-text">使用 sed 操作文本文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看 -Linux- 系统的发行版本"><span class="nav-number">5.1.5.</span> <span class="nav-text">查看 Linux 系统的发行版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看 -Linux- 系统的核数"><span class="nav-number">5.1.6.</span> <span class="nav-text">查看 Linux 系统的核数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#split- 拆分文件"><span class="nav-number">5.1.7.</span> <span class="nav-text">split 拆分文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#curl- 请求网络"><span class="nav-number">5.1.8.</span> <span class="nav-text">curl 请求网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文本文件行数"><span class="nav-number">5.1.9.</span> <span class="nav-text">文本文件行数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件去重"><span class="nav-number">5.1.10.</span> <span class="nav-text">文件去重</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#随机获取文本内容"><span class="nav-number">5.1.11.</span> <span class="nav-text">随机获取文本内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#计算交集差集并集"><span class="nav-number">5.1.12.</span> <span class="nav-text">计算交集差集并集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka"><span class="nav-number">5.2.</span> <span class="nav-text">Kafka</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zookeeper"><span class="nav-number">5.3.</span> <span class="nav-text">Zookeeper</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis"><span class="nav-number">5.4.</span> <span class="nav-text">Redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase"><span class="nav-number">5.5.</span> <span class="nav-text">HBase</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spark"><span class="nav-number">5.6.</span> <span class="nav-text">Spark</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#大数据任务调度系统"><span class="nav-number">6.</span> <span class="nav-text">大数据任务调度系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#yarn"><span class="nav-number">6.1.</span> <span class="nav-text">yarn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#移动队列"><span class="nav-number">6.1.1.</span> <span class="nav-text">移动队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#取消任务"><span class="nav-number">6.1.2.</span> <span class="nav-text">取消任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下载日志"><span class="nav-number">6.1.3.</span> <span class="nav-text">下载日志</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#操作系统"><span class="nav-number">7.</span> <span class="nav-text">操作系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#回车换行"><span class="nav-number">7.1.</span> <span class="nav-text">回车换行</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016&ndash;<span itemprop="copyrightYear">2020</span> <span class="post-meta-divider">|</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">虾丸派</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">全站字数统计</span> <span title="全站字数统计">320.7k 字</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动</div><span class="post-meta-divider">|</span><div class="theme-info">主题&nbsp;<a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">NexT.Mist</a><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-divider">|</span> 总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-divider">|</span> 总访客 <span id="busuanzi_value_site_uv"></span> 人</span></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script src="//unpkg.com/valine@1.3.7/dist/Valine.min.js"></script><script type="text/javascript">new Valine({av:AV,el:"#comments",verify:!1,notify:!1,app_id:"FC5Jijeg1meo2K2OzPYWK327-gzGzoHsz",app_key:"6A1ReY8tjhPutK00F01YbJSq",placeholder:"没有问题吗？"})</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{scale:1,jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"left",width:100,height:200,hOffset:0,vOffset:-20},mobile:{show:!1,motion:!0,scale:.3},log:!1})</script></body></html><!-- rebuild by neat -->