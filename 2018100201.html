<!-- build time:Fri May 01 2020 01:42:02 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-240x240-playpi.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-playpi.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-playpi.png?v=5.1.3"><link rel="mask-icon" href="/images/logo-playpi.svg?v=5.1.3" color="#222"><meta name="keywords" content="Hexo,travis-ci,GitHub"><link rel="alternate" href="/atom.xml" title="虾丸派" type="application/atom+xml"><meta name="description" content="我的博客一开始是搭建在阿里云上面的，购买了一台 VPS，然后在上面部署了 Git 仓库服务、Nginx 服务，同时也购买了一个域名。每次在本地写完博客，generate 后，直接使用 Hexo 自带的 deploy 命令把内容发布，同时在服务端的 Git 里面再设置一个 WebHook，触发自动拉取更新到 Nginx 项目目录的操作。这样，只要安心在本地写博客就行，写完就 generate、dep"><meta name="keywords" content="Hexo,travis-ci,GitHub"><meta property="og:type" content="article"><meta property="og:title" content="Hexo 博客集成 travis-ci 自动化测试发布"><meta property="og:url" content="https://www.playpi.org/2018100201.html"><meta property="og:site_name" content="虾丸派"><meta property="og:description" content="我的博客一开始是搭建在阿里云上面的，购买了一台 VPS，然后在上面部署了 Git 仓库服务、Nginx 服务，同时也购买了一个域名。每次在本地写完博客，generate 后，直接使用 Hexo 自带的 deploy 命令把内容发布，同时在服务端的 Git 里面再设置一个 WebHook，触发自动拉取更新到 Nginx 项目目录的操作。这样，只要安心在本地写博客就行，写完就 generate、dep"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001757.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001740.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001733.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001725.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001706.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001642.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001556.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512003256.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001610.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001421.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001344.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001324.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001333.png"><meta property="og:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001033.png"><meta property="og:updated_time" content="2019-05-11T07:38:12.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Hexo 博客集成 travis-ci 自动化测试发布"><meta name="twitter:description" content="我的博客一开始是搭建在阿里云上面的，购买了一台 VPS，然后在上面部署了 Git 仓库服务、Nginx 服务，同时也购买了一个域名。每次在本地写完博客，generate 后，直接使用 Hexo 自带的 deploy 命令把内容发布，同时在服务端的 Git 里面再设置一个 WebHook，触发自动拉取更新到 Nginx 项目目录的操作。这样，只要安心在本地写博客就行，写完就 generate、dep"><meta name="twitter:image" content="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001757.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.3",sidebar:{position:"left",display:"hide",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.playpi.org/2018100201.html"><title>Hexo 博客集成 travis-ci 自动化测试发布 | 虾丸派</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">虾丸派</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">烂笔头</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-books"><a href="/books/" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i><br>书籍</a></li><li class="menu-item menu-item-guide"><a href="/guide/" rel="section"><i class="menu-item-icon fa fa-fw fa-location-arrow"></i><br>指南</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.playpi.org/2018100201.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="虾丸派"><meta itemprop="description" content="记录知识 | 分享技术"><meta itemprop="image" content="/images/favicon-1536x1536-playpi.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="虾丸派"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Hexo 博客集成 travis-ci 自动化测试发布</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-02T15:38:12+08:00">2018-10-02 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/building/" itemprop="url" rel="index"><span itemprop="name">建站</span> </a></span></span><span id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-divider">|</span> 阅读次数 <span id="busuanzi_value_page_pv"></span></span><div class="post-wordcount"><span class="post-meta-item-text">字数统计</span> <span title="字数统计">5,827字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">22分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p>我的博客一开始是搭建在阿里云上面的，购买了一台 <code>VPS</code>，然后在上面部署了 <code>Git</code> 仓库服务、<code>Nginx</code> 服务，同时也购买了一个域名。每次在本地写完博客，<strong>generate</strong> 后，直接使用 <code>Hexo</code> 自带的 <strong>deploy</strong> 命令把内容发布，同时在服务端的 <code>Git</code> 里面再设置一个 <code>WebHook</code>，触发自动拉取更新到 <code>Nginx</code> 项目目录的操作。这样，只要安心在本地写博客就行，写完就 <strong>generate、deploy</strong> 两下，看似很完美。</p><p>然而，使用了几个月就发现了各种麻烦事，例如：<code>VPS</code> 流量不够【恶意攻击或者爬虫】、<code>VPS</code> 服务不稳定【怀疑是被恶意攻击】、每次都要在本地生成【<strong>generate</strong> 命令】、两台电脑的环境配置不一致导致的兼容性问题、博客的整个管理还是略显繁琐。于是，我思考了好几天，并查看了别的成熟案例，最终决定使用 <code>GitHub</code>、<code>travis-ci</code> 搭配，完全的自动化测试部署，本地只负责写 <code>Markdown</code> 文档。这种方案才是真的简约、安全、方便。</p><a id="more"></a><h1 id="前提"><a href="# 前提" class="headerlink" title="前提"></a>前提</h1><h2 id="开源项目"><a href="# 开源项目" class="headerlink" title="开源项目"></a> 开源项目</h2><p>首先说一下大前提，由于使用的所有工具、服务都是免费的，会暴露项目的信息、配置文件、日志信息，也就是说在 <code>GitHub</code> 中的项目类型要设置为 <code>public</code> 类型，使用 <code>travis-ci</code> 也要使用免费版本的【域名是 <code>org</code> 后缀的，不是 <code>com</code> 后缀的】。</p><p>把本地的项目提交到 <code>GitHub</code> 上面去，所以需要在 <code>GitHub</code> 上面新建一个空白项目，用来对接本地的项目。这里需要注意，为了使用 <code>GitHub Pages</code> 提供的独立子域名【<a href="https://username.github.io" target="_blank" rel="noopener">https://username.github.io</a> 】，需要把项目名称设置为 <strong>username.github.io</strong> 格式的。当然，任意项目名称命名的项目都可以作为 <code>GitHub Pages</code>，可以在 <code>GitHub</code> 的域名后面指定项目名称访问，但是不能使用独立子域名访问。</p><p>关于这个项目的分支管理，就比较独特了，因为源代码可以说只有配置文件、<code>Markdown</code> 文本文件，而经过 <code>Hexo</code> 编译生成文件基本全部是 <code>HTML</code> 文件。为了方便管理，这两种文件不要放在一起。所以可以用 <strong>matser</strong> 分支存放 <code>Hexo</code> 编译生成 <code>HTML</code> 文件，给 <code>GitHub Pages</code> 使用；而重新建立一个 <strong>source</strong> 分支【可以设置为孤儿分支，<code>orphan</code>】用来存放配置文件、<code>Markdown</code> 文本文件，用来更改、提交博客内容。这两个分支是完全没有关联的，不需要合并，他们存放的是完全不同类型的文件。</p><p>总结一下，对于 <code>GitHub</code> 中的项目，命名最好遵循 <strong>username.github.io</strong> 这样的格式，方便 <code>GitHub Pages</code> 分配独立的子域名，设置两个分支：<code>master</code>、<code>source</code>。其中，<code>master</code> 分支用来给 <code>travis-ci</code> 提交编译生成的 <code>HTML</code> 文件，可以通过 <code>GitHub Pages</code> 访问；<code>source</code> 分支用来本地提交写博客内容的 <code>Markdown</code> 文件，同时也给 <code>travis-ci</code> 监控，用来获取最新的博客并生成 <code>HTML</code> 文件提交到 <code>master</code> 分支。</p><p>为了直观起见，下面画一个流程图，清晰地表现出 <code>GitHub</code> 项目的设置：</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001757.png" alt="画一个流程图" title="画一个流程图"></p><h2 id="子模块管理"><a href="# 子模块管理" class="headerlink" title="子模块管理"></a>子模块管理</h2><p>此外，还需要特别注意主题对应的项目，因为在 <code>Hexo</code> 项目中，主题是独立的项目，存放在 <code>themes</code> 文件夹内，例如默认的 <strong>landscape</strong> 主题。由于是独立的项目，而且是嵌套在 <code>Hexo</code> 中的，对于 <code>Git</code> 来说它属于子模块【<code>submodule</code>】，所以在对接 <code>GitHub</code> 时会遇到一些子模块的问题。具体如何解决我在这里不赘述，可以自行搜索解决方案，但是我要提出必要的思路：</p><p>一、由于主题子模块默认是在 <code>GitHub</code> 上 <code>clone</code> 下来的，而为了优化显示，我们一定会更改配置文件以及源代码，所以此时一定要解除主题与原来官方 <code>GitHub</code> 仓库的关系，转而把它连接到自己的 <code>GitHub</code> 仓库中。这样自己维护主题配置，避免更新时被官方的空白配置覆盖掉，当然，这样做就失去了与原来官方 <code>GitHub</code> 仓库的联系，导致不能及时获取更新【优化升级、<code>bug</code> 修复等】。</p><p>二、针对一中的情况，最好的做法是先在自己的仓库中 <code>Fork</code> 一份官方的主题源代码，然后在 <code>Hexo</code> 中的主题文件夹中使用自己 <code>Fork</code> 的主题源代码，这样既可以自己维护主题的配置，也能及时从官方拉取更新。此处会用到 <strong>git submodule init</strong>、<strong>git submodule update</strong> 等命令。</p><p>三、还有一种最简单但是不合理的做法，直接取消主题的 <code>Git</code> 项目属性，即把 <code>Git</code> 相关的配置删除，这样主题项目就不是 <code>Hexo</code> 的子模块了，只是一个普通的文件夹，可以随意更改，并且仅仅作为 <code>Hexo</code> 的一个子文件夹而已，永远不会更新。</p><h1 id="持续集成"><a href="# 持续集成" class="headerlink" title="持续集成"></a>持续集成</h1><p><code>travis-ci</code> 是一种持续集成的工具，持续集成【<code>Continuous Integration</code>】简称为 <code>CI</code>，当然类似的工具有好几种，例如：<code>Jenkins</code>、<code>GitLab CI</code>、<code>Go CD</code> 等，这里就不再赘述。这种工具可以提供一个持续集成功能的平台，在平台上面为你的项目配置好需要执行的操作，例如测试、编译、打包、部署等，这些配置都会有特定的方言规则，不同工具之间大同小异。此外，<code>travis-ci</code> 有两种版本，一种是收费的版本，网址为：<a href="https://travis-ci.com" target="_blank" rel="noopener">https://travis-ci.com</a> ，还有一种是免费的版本，网址为：<a href="https://travis-ci.org" target="_blank" rel="noopener">https://travis-ci.org</a> ，我使用的是免费的版本。</p><p>那么，使用这种持续集成的工具有什么好处呢？下面就会一一列举，当然，只是看解释说明可能无法感受，所以可以亲手测试一下各种场景，或者等完全部署完成之后再回头看它的好处。</p><h2 id="优点一修改可以立即生效"><a href="# 优点一修改可以立即生效" class="headerlink" title="优点一修改可以立即生效"></a>优点一修改可以立即生效</h2><p>例如你几天前发表了一篇博客，过了几天你发现里面竟然有错别字或者概念性的歧义，为了保证博客的质量，这个最好及时修复。如果自己的电脑在身边还可以操作，直接 <strong>修改文件、generate、deploy</strong> 即可，但是如果只有一台普通的电脑，里面没有 <code>Git</code>、<code>Hexo</code>、<code>Node.js</code> 等环境，这个就很麻烦，恐怕装开发环境就要很久。</p><p>但是使用了 <code>travis-ci</code> 之后，这些和环境有关的操作都是它自动化完成的，你只要负责修改文件、提交更新到 <code>GitHub</code> 即可。你可以在本地只安装 <code>Git</code> 环境，<code>clone</code> 代码之后修改完再提交，当然更简单的是直接使用浏览器登录 <code>GitHub</code> 网站，在线直接修改文件提交。提交之后，会自动触发 <code>travis-ci</code> 的工作流程，编译、生成、部署等步骤全部由 <code>travis-ci</code> 自动完成，真的是解放了双手。</p><h2 id="优点二自动部署到多个远程仓库"><a href="# 优点二自动部署到多个远程仓库" class="headerlink" title="优点二自动部署到多个远程仓库"></a>优点二自动部署到多个远程仓库</h2><p>这个优点在 <code>Hexo</code> 自带的 <code>deploy</code> 功能中也有，可以把最新的代码同步到 <code>GitHub</code> 以外的远程仓库。有的人觉得在中国大陆 <code>GitHub</code> 的访问速度比较慢，就想着多部署几个站点，例如 <code>Gitcafe</code>、码云等，很简单，在 <code>travis-ci</code> 的脚本中多配置几行命令脚本即可，完全是自定义。</p><h2 id="优点三部署快捷方便"><a href="# 优点三部署快捷方便" class="headerlink" title="优点三部署快捷方便"></a>优点三部署快捷方便</h2><p>当后期博客项目过大的时候，会需要一些自定义的优化点，例如搜索、字数统计、文件压缩等，这些特性都需要插件的支持，所以会安装很多插件，同时生成的静态文件也会越来越多。如果按照传统的手动管理方式，每次都需要提交大量的文件更新到远程仓库，耗时长而且没有必要，但是使用 <code>travis-ci</code> 之后，只需要提交 <code>Markdown</code> 文件的变更，其它的大量文件都交给 <code>travis-ci</code> 去生成，这样一来速度就很快了，时间消耗都转移到 <code>travis-ci</code> 上面去了。</p><h2 id="优点四显示构建图标"><a href="# 优点四显示构建图标" class="headerlink" title="优点四显示构建图标"></a>优点四显示构建图标</h2><p>对接 <code>travis-ci</code> 后，可以在 <code>README</code> 文件里显示持续集成工具构建结果的图标，是失败还是成功就很形象了。</p><h2 id="其它优点"><a href="# 其它优点" class="headerlink" title="其它优点"></a>其它优点</h2><p>1、通过设置失败邮件提醒，在构建失败时会发送邮件通知。</p><p>2、如果设置了优点四中的构建图标，可以在 <code>GitHub</code> 的项目中，直接点击图标，然后会自动跳转到 <code>travis-ci</code> 的构建页面，可以查看构建日志、历史记录、项目配置等信息。</p><p>3、此外还可以配置自动化测试、构建成功才继续部署等选择项。</p><h1 id="配置详解"><a href="# 配置详解" class="headerlink" title="配置详解"></a> 配置详解</h1><h2 id="登录持续集成帐号"><a href="# 登录持续集成帐号" class="headerlink" title="登录持续集成帐号"></a> 登录持续集成帐号</h2><p>打开官方网站：<a href="https://travis-ci.org" target="_blank" rel="noopener">https://travis-ci.org</a> ，登录帐号，注意不需要注册，一定要使用 <code>GitHub</code> 帐号授权的方式登录，只有这样 <code>travis-ci</code> 才能获取到 <code>GitHub</code> 上面的项目信息，进而进行管理。</p><h2 id="开启项目管理权限"><a href="# 开启项目管理权限" class="headerlink" title="开启项目管理权限"></a>开启项目管理权限</h2><p>在 <code>Settings</code>、<code>Repositories</code> 中可以看到自己在 <code>GitHub</code> 上面的项目列表，但是 <code>travis-ci</code> 默认是不会管理任何一个项目的，需要手动开启。由于只需要监控我的博客项目，所以只是开启这一个，然后在开启按钮的右边点击设置按钮，进行下一步的设置。</p><p>开启管理权限。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001740.png" alt="开启管理权限" title="开启管理权限"></p><p>进入到具体项目的设置页面，在这里，需要勾选 <strong>General</strong> 下面的 <strong>Build pushed branches</strong>、<strong>Build pushed pull requests</strong>，这两个选项的意思是当 <code>GitHub</code> 的项目有 <strong>push</strong> 操作时，则 <code>travis-ci</code> 会执行配置的流程。</p><p>设置 <code>General</code>。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001733.png" alt="设置 General" title="设置 General"></p><p>再看下面的 <strong>Auto Cancellation</strong>，需要勾选 <strong>Auto cacel branch builds</strong>、<strong>Auto cancel pull request builds</strong>，这两个选项的意思是自动取消构建过程，主要用于当有连续多个 <code>push</code>、<code>push pull request</code> 发生时，可能先后间隔很短时间内触发了多次构建操作，这样显然浪费资源，没必要构建中间的 <code>push</code>，所以构建排队队列中的任务会自动取消，只保留最新的 <code>push</code> 触发的构建作业。当然，前提是必须等待正在运行的构建作业完成。</p><p>设置 <code>Auto Cancellation</code>。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001725.png" alt="设置 Auto Cancellation" title="设置 Auto Cancellation"></p><h2 id="按需设置环境变量"><a href="# 按需设置环境变量" class="headerlink" title="按需设置环境变量"></a>按需设置环境变量</h2><p>在设置中的 <strong>Environment Variables</strong> 里面，可以指定一些环境变量【其实就是全局变量】，这些变量可以在后面的构建脚本中直接使用。那么为什么要这么设置呢，有必要吗？</p><p>其实，一是为了安全，如果直接在构建脚本中使用字符串的形式暴露出来，势必会泄漏个人信息，例如在 <code>GitHub</code> 申请的 <code>TOKEN</code>、邮箱、用户名，这些信息肯定不能泄漏；二是为了方便，设置了全局变量，在构建脚本中直接引用，简化脚本内容，而且以后如果有更改，直接来到 <code>travis-ci</code> 更改环境变量即可，不需要更改构建脚本。因此，这些信息的设置是很有必要的。</p><p>当然，也不用在这里设置太多信息，有一些不重要的信息直接在构建脚本中使用字符串设置变量即可【构建方言规则里面有 <code>env</code>、<code>global</code> 可以设置只在脚本中有效的全局变量】。</p><p>我在这里设置了四个全局变量：<code>REPO_TOKEN</code>、<code>GITHUB_URL</code>、<code>USER_EMAIL</code>、<code>USER_NAME</code>，其中 <code>REPO_TOKEN</code> 是在 <code>GitHub</code> 中生成的访问验证信息，下面会讲怎么生成。</p><p>设置 <code>Environment Variables</code>。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001706.png" alt="设置 Environment Variables" title="设置 Environment Variables"></p><p>切记，不要勾选 <strong>Display value in build log</strong>，否则这些信息还是会在 <code>travis-ci</code> 的构建日志中显示出来，也就是暴露了。</p><h2 id="其它设置选项"><a href="# 其它设置选项" class="headerlink" title="其它设置选项"></a>其它设置选项</h2><p>还有一个名称为 <strong>Cron Jobs</strong> 的设置选项，这个设置就是开启定时任务，可以选择分支、周期、任务操作，如果你需要周期性地对 <code>GitHub</code> 项目进行操作就可以在这里配置。举个例子，如果你不要求你的博客的实时性，即不需要实时更新，可以不用设置上面的 <strong>General</strong>，直接在这里添加一个周期性任务，每天自动构建一次，这样你更新的博客内容要等一天才能更新到博客网站上面。</p><p>显然，如果为了保证实时性，这个选项是没有意义的，一般不需要开启。</p><p>至此，在 <code>travis-ci</code> 中的设置内容已经完成，<code>travis-ci</code> 已经在监控 <code>GitHub</code> 中的项目了，但是还有两件重要的事没做：生成验证信息、写自动构建脚本。</p><h2 id="生成项目的访问验证信息"><a href="# 生成项目的访问验证信息" class="headerlink" title="生成项目的访问验证信息"></a>生成项目的访问验证信息</h2><p>在设置环境变量的步骤中，用到了一个变量：<code>REPO_TOKEN</code>，这个是访问 <code>GitHub</code> 项目的验证信息，作用等同于用户名、密码，下面我们需要生成它。</p><p>在 <code>GitHub</code> 的个人设置中【不是单个项目的设置】，依次找到 <strong>Settings</strong>、<strong>Developer settings</strong>、<strong>Personal access tokens</strong>，这里面的内容就是开发者设置信息，可以生成一些隐私信息给开发者使用，方便程序直接调用接口，我也需要给 <code>travis-ci</code> 生成一个。</p><p>设置 <code>Personal access tokens</code>。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001642.png" alt="设置 Personal access tokens" title="设置 Personal access tokens"></p><p>选择 <strong>Generate new token</strong> 按钮，为了安全，<code>GitHub</code> 还会要求验证一次密码，接着就进入到配置页面。在配置页面填写名称、权限即可，我这里只选择了 <strong>repo</strong> 权限，其它的目前没有必要。</p><p>注意，生成的 <code>TOKEN</code> 信息是一串字符串，<code>GitHub</code> 只会显示一次，所以要及时复制，刷新页面或者后续再回来查看是看不到的，只能重新申请。把这里生成的 <code>TOKEN</code> 作为设置环境变量步骤中的 <strong>REPO_TOKEN</strong> 的值即可，这样，在 <code>travis-ci</code> 构建脚本中就能访问 <code>GitHub</code> 从而进行 <code>push</code> 代码更新了。</p><p>生成 <code>token</code> 填写信息。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001556.png" alt="生成 token 填写信息" title="生成 token 填写信息"></p><h2 id="写自动构建脚本"><a href="# 写自动构建脚本" class="headerlink" title="写自动构建脚本"></a>写自动构建脚本</h2><p>在 <code>GitHub</code> 项目的 <code>source</code> 分支的根目录下，添加一个 <strong>.travis.yml</strong> 文件，这是 <code>travis-ci</code> 官方要求的，里面填写构建流程。这个配置文件已经被我上传至 <code>GitHub</code>，读者可以提前下载查看：<a href="https://github.com/iplaypi/iplaypi.github.io/tree/source" target="_blank" rel="noopener">.travis.yml</a> ，配置文件命名固定为：<code>.travis.yml</code>。</p><p>构建脚本内容的格式需要符合 <code>travis-ci</code> 的方言规范，里面也会用到上面设置的环境变量【只有具有脚本属性的内容才可以使用环境变量，其它不可以，例如邮件通知里面就不能使用环境变量】，获取环境变量的值使用 <strong>${环境变量名称}</strong> 格式，与使用 <code>Linux</code> 平台的环境变量格式一致，完整内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"># 使用语言为 Node.js</span><br><span class="line">language: node_js</span><br><span class="line"># Node.js 版本，Node 11.0.0 版本 yarn install 会报错不支持 </span><br><span class="line"># node_js: stable</span><br><span class="line">node_js: 10.10.0</span><br><span class="line"># 设置只监听哪个分支 </span><br><span class="line">branches:</span><br><span class="line">  only:</span><br><span class="line">  - source</span><br><span class="line"># 缓存，可以节省集成的时间，这里用了 yarn, 如果不用可以删除 </span><br><span class="line">cache:</span><br><span class="line">  apt: true</span><br><span class="line">  yarn: true</span><br><span class="line">  directories:</span><br><span class="line">    - node_modules</span><br><span class="line">    - CNAME</span><br><span class="line"># env</span><br><span class="line"># 全局变量，为了安全，不要在这里设置，我这里设置只是示例，其实没有用到 </span><br><span class="line">env:</span><br><span class="line"> global:</span><br><span class="line">   - GITHUB_XXX_URL: github.com/iplaypi/iplaypi.github.io.git</span><br><span class="line"># tarvis 生命周期执行顺序详见官网文档 </span><br><span class="line">before_install:</span><br><span class="line"># 更改时区 </span><br><span class="line">- export TZ=&apos;Asia/Shanghai&apos;</span><br><span class="line">- git config --global user.name $&#123;USER_NAME&#125;</span><br><span class="line">- git config --global user.email $&#123;USER_EMAIL&#125;</span><br><span class="line"># 由于使用了 yarn, 所以需要下载，不用 yarn 这两行可以删除 </span><br><span class="line">- curl -o- -L https://yarnpkg.com/install.sh | bash</span><br><span class="line">- export PATH=$HOME/.yarn/bin:$PATH</span><br><span class="line"># hexo 基础工具 </span><br><span class="line">- npm install -g hexo-cli</span><br><span class="line"># 初始化所需模块，在 package.json 中配置的有，这样 node_modules 就不用提交到 GitHub 了 </span><br><span class="line"># 下次如果换电脑，安装完 Node.js, 全局 (-g 参数) 安装完 hexo-cli, 直接在项目根目录初始化即可 (在 package.json 配置的都会自动下载)</span><br><span class="line">- npm install</span><br><span class="line"># 本地搜索需要工具 </span><br><span class="line">- npm install hexo-generator-searchdb --save</span><br><span class="line"># 字数统计，时长统计需要工具，Node 版本 7.6.0 之前，请安装 2.x 版本，npm install hexo-wordcount@2 --save</span><br><span class="line">- npm install hexo-wordcount --save</span><br><span class="line"># 站点地图，seo 优化使用 </span><br><span class="line">- npm install hexo-generator-sitemap --save</span><br><span class="line">- npm install hexo-generator-baidu-sitemap --save</span><br><span class="line"># 中英文之间自动增加空格插件 </span><br><span class="line"># - npm install hexo-filter-auto-spacing --save (这个人用的少，不用了)</span><br><span class="line">- npm install hexo-pangu-spacing --save</span><br><span class="line"># rss 订阅插件 </span><br><span class="line">- npm install hexo-generator-feed --save</span><br><span class="line"># 三维卡通人物 </span><br><span class="line">- npm install --save hexo-helper-live2d</span><br><span class="line"># 三维卡通人物 - 小猫咪模型下载 (保险起见，把模型文件放到自己的文件夹里，不用每次下载)</span><br><span class="line"># - npm install --save live2d-widget-model-hijiki</span><br><span class="line"># 压缩文件 </span><br><span class="line">- npm install hexo-neat --save</span><br><span class="line">install:</span><br><span class="line"># 不用 yarn 的话这里改成 npm i 即可 </span><br><span class="line">- yarn</span><br><span class="line"># script</span><br><span class="line"># 以后把主题发布到 GitHub 中，先从官方 Fork 再更新自定义的，这里还需要更新子模块内容，示例:git submodule init,git submodule update</span><br><span class="line"># 新建.gitmodules 文件，内容 </span><br><span class="line"># [submodule &quot;themes/next&quot;]</span><br><span class="line">#    path = themes/next</span><br><span class="line">#    url = git://github.com/xin053/MyHexo_NexT_Theme</span><br><span class="line"># 此外，还有那个评论系统的升级，Valine, 思考怎么做 </span><br><span class="line">script:</span><br><span class="line">- hexo clean</span><br><span class="line">- hexo generate</span><br><span class="line"># 成功之后才会提交，如果失败就会跳过并发送失败邮件通知 </span><br><span class="line">after_success:</span><br><span class="line"># 获取 master 分支内容 </span><br><span class="line">- git clone https://$&#123;GITHUB_URL&#125; .deploy_git</span><br><span class="line">- cd .deploy_git</span><br><span class="line">- git checkout master</span><br><span class="line">- cp -rf ../public/* ./</span><br><span class="line"># 必要配置文件 </span><br><span class="line">- cp -rf ../README.md ../.gitignore ../CNAME ../index.php ./</span><br><span class="line"># 更改 .gitignore 内容，与 source 分支的不一样，直接置空，目前没有需要过滤的 </span><br><span class="line">- echo &quot;&quot; &gt; ./.gitignore</span><br><span class="line">- git add .</span><br><span class="line"># 提交记录包含时间，跟上面更改时区配合 </span><br><span class="line">- git commit -m &quot;Travis CI Auto Builder at `date +&quot;% Y-% m-% d % H:% M&quot;`&quot;</span><br><span class="line"># 推送到主分支 </span><br><span class="line">- git push --force --quiet &quot;https://$&#123;REPO_TOKEN&#125;@$&#123;GITHUB_URL&#125;&quot; master:master</span><br><span class="line"></span><br><span class="line"># 邮件通知机制，我在这里设置了成功 / 失败都会通知，这里不能使用环境变量 </span><br><span class="line"># configure notifications (email, IRC, campfire etc)</span><br><span class="line"># please update this section to your needs!</span><br><span class="line"># https://docs.travis-ci.com/user/notifications/</span><br><span class="line">notifications:</span><br><span class="line">  email:</span><br><span class="line">    - playpi@qq.com</span><br><span class="line">  on_success: always</span><br><span class="line">  on_failure: always</span><br></pre></td></tr></table></figure><p>我在构建脚本里面已经尽可能添加了注释说明，解释地很清晰了，那我在这里再说明一下构建脚本具体的思路：</p><ul><li>指定环境、工具版本、监控的分支【只监控 source 分支】，开启缓存，设置全局变量</li><li>在 before_install 流程中进行环境的初始化</li><li>在 install 流程中安装基础环境【在这里 yarn 会使用缓存的内容，节约时间】</li><li>在 script 流程中生成 HTML 文件</li><li>在 after_success 流程中将最新代码推送到 master 分支【构建成功才会进行】</li><li>在 notifications 流程中执行通知邮箱与通知方式</li></ul><p>这里要特别注意，我没有在构建脚本中使用 <strong>hexo deploy</strong>，所以在安装插件阶段也没有安装 <strong>hexo-deployer-git</strong>【对于我来说它不够灵活，只能发布 <code>public</code> 文件夹下面的内容】，因为我这里情况比较复杂，需要复制一些自定义的文件到 <code>master</code> 分支，而且我这里不再提交更新到 <code>VPS</code> 或者其它托管网站【这个我使用别的方式另外做了】。如果你的情况只是简单地自动部署，则在 <strong>after_success</strong> 流程中不需要那么多脚本，直接 <strong>hexo deploy</strong> 就行【当然别忘了在 <code>Hexo</code> 的配置文件 <code>_config.yml</code> 中加上 <code>deploy</code> 相关配置】。</p><p>此外，我这里直接把主题的 <code>Git</code> 属性取消了，主题的文件夹被当作普通的文件夹提交到了 <code>source</code> 分支，这只是暂时的做法【而且显然不妥】，后面会把主题独立发布为一个项目，作为 <code>Hexo</code> 的一个 <code>Git</code> 子模块使用，敬请期待。我现在这么做虽然不妥，但是没有办法，因为我自己更改了太多的主题配置文件，而且版本过于陈旧，把这个主题项目单独整理出来需要消耗一些时间，以后会作为独立的博客发表一篇的，到时候构建脚本也会有小改动，敬请期待。</p><h2 id="原理简述"><a href="# 原理简述" class="headerlink" title="原理简述"></a>原理简述</h2><p><code>travis-ci</code> 为什么可以做到实时更新，只要有 <code>push pull request</code> 或者 <code>push</code> 就能被 <code>travis-ci</code> 监控到，然后去执行构建脚本。其实，背后使用的还是 <code>GitHub</code> 的 <code>Webhooks</code> 技术，由于给了 <code>travis-ci</code> 认证权限，<code>travis-ci</code> 就申请了 <code>Webhooks</code> 的发送请求，每当监控的项目有 <code>push</code> 或者 <code>push request</code> 请求时，<code>GitHub</code> 会发送项目的信息给 <code>travis-ci</code>，这样 <code>travis-ci</code> 就可以做出相应的动作，例如执行构建脚本。</p><p>这种做法我在另外一篇博客中也有实战经验，为了体验一下 <code>VPS</code> 上面的博客自动更新，也折腾了好几天，使用 <code>PHP</code> 自己搭建的服务脚本，有 <code>GitHub</code> 通知时自动拉取更新到本地指定的目录，有兴趣的可以参考一下：<a href="https://www.playpi.org/2019030601.html">使用 Github 的 WebHooks 实现代码自动更新 </a>。</p><p>可以去项目的设置中【不是用户设置】，找到 <strong>Settings</strong>、<strong>Webhooks</strong>，可以看到有一条名称为 <strong><a href="https://notify.travis-ci.org" target="_blank" rel="noopener">https://notify.travis-ci.org</a> </strong>的 <code>Webhooks</code> 记录，它就是 <code>GitHub</code> 用来通知 <code>travis-ci</code> 的接口。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512003256.png" alt="Webhooks" title="Webhooks"></p><h1 id="效果预览"><a href="# 效果预览" class="headerlink" title="效果预览"></a>效果预览</h1><h2 id="简化命令"><a href="# 简化命令" class="headerlink" title="简化命令"></a> 简化命令</h2><p>完成了整个浩大的自动化部署工程后，以前需要使用的 <code>Hexo</code> 三部曲：</p><ul><li>hexo clean</li><li>hexo generate</li><li>hexo deploy</li></ul><p>完全不需要了，取而代之的是 <code>Git</code> 三部曲：</p><ul><li>git add .</li><li>git commit -am ‘update message’</li><li>git push</li></ul><p>当然，在本地测试时还是要使用 <code>Hexo</code> 三部曲</p><ul><li>hexo clean</li><li>hexo generate</li><li>hexo sever</li></ul><h2 id="查看项目构建信息"><a href="# 查看项目构建信息" class="headerlink" title="查看项目构建信息"></a> 查看项目构建信息</h2><p>在本地更新 <code>source</code> 分支的文本内容，提交到 <code>GitHub</code> 上面，然后去看 <code>travis-ci</code> 的构建结果。</p><p>构建基础信息，包含构建消耗时间、项目 <code>Commit</code> 的 <code>id</code> 值、分支名、构建流程消耗时间等等。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001610.png" alt="构建基础信息" title="构建基础信息"></p><p>接着往下看，有构建日志、构建脚本内容。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001421.png" alt="构建日志" title="构建日志"></p><p>查看一下构建历史列表，可以看到所有的构建信息，每一个都会有编号，从 1 开始增加。成功的构建是绿色的，失败的是红色的。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001344.png" alt="构建历史列表" title="构建历史列表"></p><h2 id="给项目添加构建图标"><a href="# 给项目添加构建图标" class="headerlink" title="给项目添加构建图标"></a>给项目添加构建图标</h2><p>在 <code>travis-ci</code> 的项目名称右边，可以看到有一个图标，点击，在弹出的对话框中选择分支与格式，我选择 <code>source</code> 分支，<code>Markdown</code> 格式，然后在下面的文本框中就会生成一个链接，直接复制粘贴到 <code>GitHub</code> 项目中的 <code>README</code> 文件中即可。</p><p>构建图标链接生成。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001324.png" alt="构建图标链接生成" title="构建图标链接生成"></p><p><code>GitHub</code> 项目的 <code>README</code> 文件填写。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001333.png" alt="GitHub 项目的 README 文件填写" title="GitHub 项目的 README 文件填写"></p><p><code>GitHub</code> 项目的构建图标查看。</p><p><img src="https://raw.githubusercontent.com/iplaypi/img-playpi/master/img/2019/20190512001033.png" alt="GitHub 项目的构建图标查看" title="GitHub 项目的构建图标查看"></p><p>点击这个图标，是可以直接跳转到 <code>travis-ci</code> 的构建页面，可以查看构建日志、历史记录、项目配置等信息。</p><p>至此，整个自动化部署方案完全实现，并验证通过，效果超级好，以后可以直接使用 <code>Git</code> 命令提交更新了。</p></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"><img id="wechat_subscriber_qcode" src="/images/wechat-qr-personal.jpg" alt="虾丸派 wechat" style="width:200px;max-width:100%"><div>扫一扫添加博主，进技术交流群，共同学习进步</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>永不止步</div><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechat-pay-playpi.png" alt="虾丸派 微信支付"><p>微信支付</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> 虾丸派</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://www.playpi.org/2018100201.html" title="Hexo 博客集成 travis-ci 自动化测试发布">https://www.playpi.org/2018100201.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Hexo/" rel="tag"><i class="fa fa-tag"></i> Hexo</a> <a href="/tags/GitHub/" rel="tag"><i class="fa fa-tag"></i> GitHub</a> <a href="/tags/travis-ci/" rel="tag"><i class="fa fa-tag"></i> travis-ci</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018090701.html" rel="next" title="Win10 取消 Skype for Business 自动登录"><i class="fa fa-chevron-left"></i> Win10 取消 Skype for Business 自动登录</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2018100601.html" rel="prev" title="地锅鸡做法总结（皖北、苏北地区）">地锅鸡做法总结（皖北、苏北地区） <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="vcomments"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/favicon-1536x1536-playpi.png" alt="虾丸派"><p class="site-author-name" itemprop="name">虾丸派</p><p class="site-description motion-element" itemprop="description">记录知识 | 分享技术</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">140</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">289</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/iplaypi" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://weibo.com/u/3086148515" target="_blank" title="微博"><i class="fa fa-fw fa-weibo"></i>微博</a> </span><span class="links-of-author-item"><a href="mailto:playpi@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank" rel="external nofollow"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://github.com/iplaypi" title="GitHub" target="_blank" rel="external nofollow">GitHub</a></li><li class="links-of-blogroll-item"><a href="https://weibo.com/u/3086148515" title="Weibo" target="_blank" rel="external nofollow">Weibo</a></li><li class="links-of-blogroll-item"><a href="https://www.playpi.org" title="虾丸派" target="_blank" rel="external nofollow">虾丸派</a></li><li class="links-of-blogroll-item"><a href="https://www.playpi.org" title="playpi" target="_blank" rel="external nofollow">playpi</a></li><li class="links-of-blogroll-item"><a href="https://www.liaoxuefeng.com" title="廖雪峰" target="_blank" rel="external nofollow">廖雪峰</a></li><li class="links-of-blogroll-item"><a href="http://www.ruanyifeng.com" title="阮一峰" target="_blank" rel="external nofollow">阮一峰</a></li><li class="links-of-blogroll-item"><a href="https://travis-ci.org/iplaypi/iplaypi.github.io" title="travis-ci" target="_blank" rel="external nofollow">travis-ci</a></li><li class="links-of-blogroll-item"><a href="https://www.vultr.com/?ref=7861302-4F" title="Vultr" target="_blank" rel="external nofollow">Vultr</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前提"><span class="nav-number">1.</span> <span class="nav-text">前提</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#开源项目"><span class="nav-number">1.1.</span> <span class="nav-text">开源项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#子模块管理"><span class="nav-number">1.2.</span> <span class="nav-text">子模块管理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#持续集成"><span class="nav-number">2.</span> <span class="nav-text">持续集成</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#优点一修改可以立即生效"><span class="nav-number">2.1.</span> <span class="nav-text">优点一修改可以立即生效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优点二自动部署到多个远程仓库"><span class="nav-number">2.2.</span> <span class="nav-text">优点二自动部署到多个远程仓库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优点三部署快捷方便"><span class="nav-number">2.3.</span> <span class="nav-text">优点三部署快捷方便</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优点四显示构建图标"><span class="nav-number">2.4.</span> <span class="nav-text">优点四显示构建图标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其它优点"><span class="nav-number">2.5.</span> <span class="nav-text">其它优点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置详解"><span class="nav-number">3.</span> <span class="nav-text">配置详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#登录持续集成帐号"><span class="nav-number">3.1.</span> <span class="nav-text">登录持续集成帐号</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开启项目管理权限"><span class="nav-number">3.2.</span> <span class="nav-text">开启项目管理权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#按需设置环境变量"><span class="nav-number">3.3.</span> <span class="nav-text">按需设置环境变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其它设置选项"><span class="nav-number">3.4.</span> <span class="nav-text">其它设置选项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成项目的访问验证信息"><span class="nav-number">3.5.</span> <span class="nav-text">生成项目的访问验证信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#写自动构建脚本"><span class="nav-number">3.6.</span> <span class="nav-text">写自动构建脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原理简述"><span class="nav-number">3.7.</span> <span class="nav-text">原理简述</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#效果预览"><span class="nav-number">4.</span> <span class="nav-text">效果预览</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简化命令"><span class="nav-number">4.1.</span> <span class="nav-text">简化命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看项目构建信息"><span class="nav-number">4.2.</span> <span class="nav-text">查看项目构建信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#给项目添加构建图标"><span class="nav-number">4.3.</span> <span class="nav-text">给项目添加构建图标</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016&ndash;<span itemprop="copyrightYear">2020</span> <span class="post-meta-divider">|</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">虾丸派</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">全站字数统计</span> <span title="全站字数统计">311.9k 字</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动</div><span class="post-meta-divider">|</span><div class="theme-info">主题&nbsp;<a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">NexT.Mist</a><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-divider">|</span> 总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-divider">|</span> 总访客 <span id="busuanzi_value_site_uv"></span> 人</span></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script src="//unpkg.com/valine@1.3.7/dist/Valine.min.js"></script><script type="text/javascript">new Valine({av:AV,el:"#comments",verify:!1,notify:!1,app_id:"FC5Jijeg1meo2K2OzPYWK327-gzGzoHsz",app_key:"6A1ReY8tjhPutK00F01YbJSq",placeholder:"没有问题吗？"})</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{scale:1,jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"left",width:100,height:200,hOffset:0,vOffset:-20},mobile:{show:!1,motion:!0,scale:.3},log:!1})</script></body></html><!-- rebuild by neat -->